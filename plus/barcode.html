<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>扫码</title>
		<script src="../js/common.js"></script>
		<link rel="stylesheet" href="../css/common.css" />
		<link rel="stylesheet" href="../css/style.css" />
		<script>
			// 加载 plus
			document.addEventListener("plusready", onPlusReady, false);
			var scan;
			// 启动扫码
			function onPlusReady() {
				scan = new plus.barcode.Barcode('bcid');
				scan.onmarked = onmarked;
			}
			// 关闭扫码
			function cancelScan() {
				scan.cancel(); // 停止
				scan.close(); // 关闭
			}
			// 扫码成功返回
			function onmarked(type, result, file) {
				plus.storage.setItem("scanCodeResult", result);
				cancelScan();
				location.assign("coderesult.html");
			}
			// 打开闪光灯
			function setFlash() {
				scan.setFlash();
			}
			// 返回前一页
			function goback() {
				cancelScan();
				history.go(-1);
			}
			// 从相册中选择二维码图片 
			function scanPicture() {
				plus.gallery.pick(function(path) {
					plus.barcode.scan(path, onmarked, function(error) {
						plus.nativeUI.alert('无法识别此图片');
					});
				}, function(err) {
					console.log('Failed: ' + err.message);
				});
			}
		</script>
	</head>

	<body style="background-color: #000;">
		<header>
			<div class="goback" onclick="goback()">
				<i class="icon-chevron-left"></i>
			</div>
			<div class="title">扫码</div>
		</header>
		<div class="contain-wrapper">
			<div id="bcid">
				<div class="txt">载入中...</div>
			</div>
		</div>
		<div class="footer barcode-footer" onclick="scanPicture()">
			<div>
				从相册选取
			</div>
		</div>
	</body>

</html>